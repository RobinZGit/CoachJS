<html>
  <head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

	<title>Тренер по хоккею и не только (генератор ритмов)</title>
<script>


//##################################################################################
//###################  ВХОДНЫЕ ДАННЫЕ… #############################################
//##################################################################################

//Краткое описание тренировки, напоминание как делать упр. и т.п. оно будет сказано после нажатиЯ кнопки "Ќачать"
var Gl_ShortDescription = "";

//<<==Ритм. Например [[3,1,0, [0,1,2]],[4,2,25, [3,4]]] - значит: 3 раза через 1 сек с дисперсией 0% делать дела [0,1,2] из Gl_aDeals , затем 4 раза чеез 2 сек с дисперсией 25% делать дела [3,4] из Gl_aDeals



var Gl_aRithm = [ //1500 раз 180+дельта шагов в мин (3 ш в сек). где дельта от -20 до 20 гармонич меняется за 2.5 мин  (750сек) на полпериода
	[1500,"(220 + 120*Math.sin(3.14*_полноевремя_/780))/(2*3*60)",0,[24]],
	//[5, .3,0,[22]] ,
	//[16,"Math.trunc(_номеритерации_1/(8))+1",0,[21]],
	//[16,"Math.trunc((32-_номеритерации_1)/(8))+1",0,[22]]

];  


//==>>

//<<== Несколько навыков в формате [<имЯ навыка>,[<Значение>,<вероЯтность(точней,пропорциЯ)>]]:


var Gl_aDeals =[//0
	["_прошловременивпроцентах_ + ' взглЯд'",["прЯмо",1],["направо",1],["прЯмо направо",1],["налево",1],["прЯмо налево",1],["назад",1],["назад направо",1],["назад налево",1]],
	//1
	["",["присел, шире шаг",4],["Спиной вперед",2],["Присел, Слалом, шире шаг",2],["Кораблик по часовой с выходом лицом",1],["Кораблик против часовой с выходом лицом",1],["Кораблик по часовой с выходом спиной",1],["Кораблик против часовой с выходом спиной",1]],
	//2
	["угол",["прЯмо",1],["направо",1],["прямо направо",1],["налево",1],["прямо налево",1],["назад",1],["назад направо",1],["назад налево",1]],
	//3
	["смена",["Броски. Установка шайб",1]],
	//4
	["выход на поле",["",1]],
	//5
	["",["Ускорение и бросок",1],["",4]],
	//6
	["шайба",["змейкой",3],["прЯмо",2],["направо",2],["прЯмо направо",2],["налево",2],["прЯмо налево",2],["назад направо",1],["назад налево",1]],
	//7
	["",["разгон - раз, два, три, четыре",1],["Дриблинг - поворот, поворот, поворот, поворот, поворот, поворот",1]],
	//8
	["",["установка шайб",1]],
	//9
	["",["кистевой бросок",2],["бросок",2],["щелчок",2],["бросок с кораблика по часовой",1],["бросок с кораблика против часовой",1]],
	//10
	["",["стоЯ",2],["с ходу прямо ",2],["с ходу справа ",2],["с ходу с прЯмо направо",2],["с ходу слева",2],["с ходу с прЯмо налево",2],["с ходу с назад направо",1],["с ходу с назад налево",1],["с ходу с назад",1]],
	//11
	["",["",1]],                
	//12
	["",["в центр",1],["вверх",1],["вниз",1],["вправо",1],["вверх вправо",1],["влево",1],["вверх влево",1],["вниз вправо",1],["вниз влево",1],["низом прямо",1],["низом вправо",1],["низом влево",1]],
	//13
	["свой свободный - пас",["прЯмо",1],["направо",1],["прЯмо направо",1],["налево",1],["прЯмо налево",1],["назад",1],["назад направо",1],["назад налево",1]],
	//14
	["",["1 метр",1],["2 метра",1],["3 метра",1],["4 метра",1],["5 метров",1],["6 метров",1],["7 метров",1],["8 метров",1],["9 метров",1],["10 метров",1]],
	//15
	["дриблинг руками",["",1]], 
	//16
	["",["кистевой бросок",2],["бросок",2],["щелчок",2],["бросок с неудобной",1]],
	//...
	//17
	["убрать шайбу, соперник",["прЯмо",1],["справа",1],["слева",1],["сзади",1],["прЯмо направо",1],["прЯмо налево",1],["сзади справа",1],["сзади слева",1]],
	//18
	["",["движение",1]], 
	//19
	["",["пас, движение",1]],
	//20
	["пас",["прЯмо",1],["направо",1],["налево",1],["назад",1],["прямо направо",1],["прямо налево",1],["назад направо",1],["назад  налево",1]],    
	//21
	["",["if(-Math.trunc(_номеритерации_1/8) + _номеритерации_1/8 > 0.49){ 'выдох '+Math.round((((_номеритерации_1) % 4)+1)*25)}else {'вдох '+ Math.round((((_номеритерации_1) % 4)+1)*25)}",1]],
	//22
	["",["if(-Math.trunc((   _номеритерации_1)/8) + (    _номеритерации_1)/8 > 0.49){ 'свыдох '+Math.round((((_номеритерации_1) % 4)+1)*25)}else {'свдох '+ Math.round((((_номеритерации_1) % 4)+1)*25)}",1]],
	//23
	["",["->22,20",1]],
	//24
	["",["if((_номеритерации_1%4) > 1){'о'}else {'ы '}",1]],

];//==>>            

//=== глобали для использования в настройке массивов  =====
var _номеритерации_  = 1
var _номеритерации_1  = 0
var _прошломилисекунд_ = 0
var _прошлосекунд_ = 0
var _прошломинут_ = 0
var _прошлочасов_ = 0
var _прошловременивпроцентах_ = 0
var _полноевремя_ = 0
//========================================================


//##################################################################################
//##################################################################################
//##################################################################################
</script>

<script>
//надписи на кнопке при изменении статуса тренировки (эти же константы используются как ИД статусов - не делать тексты одинаковыми!)   
const TXT_BTN_NOTSTARTED = "Начать";
const TXT_BTN_STARTED = "Идет тренировка...";
const TXT_BTN_PAUSED = "Тренировка приостановлена...";    
const TXT_BTN_FINISHED = "Тренировка завершена";
//    

var Gl_TestStr = "";
var Gl_nTimer = 0;
var Gl_dBeg = new Date();
var Gl_H = Gl_dBeg.getHours();
var Gl_M = Gl_dBeg.getMinutes();
var Gl_S = Gl_dBeg.getSeconds();
var Gl_Ms = Gl_dBeg.getMilliseconds();
var Gl_CountOfIterations = 0
//сколько раз повторить всю тренировку
var GlnRepeat = 1;

var Gl_dBegTraining //время начала тренировки
var Gl_duration = 0 //продолжительность тренировки

var dNowPrev

//пытаемся вычислить строку как формулу. если не получается оставляем строку как есть
function ev(s) {
	if (!((s.trim()) == ""))
  	    try
		{return eval(s)} catch(e) {return s}
	else return ""
}
var Gl_CurrDt = ev(String(Gl_aRithm[0][1]));

//уменьшение массива ритмов при завершении очередного упражнения (выбрасываем нулевой элемент, таким образом след. упр. начинается снова с нулевого элемента)
function fDecGl_aRithm () {
    if (Gl_aRithm[0][0] > 1)
	{
		Gl_aRithm[0][0] = Gl_aRithm[0][0] - 1;
    }
    else
	{
		Gl_aRithm.splice(0, 1);
    };
    Gl_CurrDt = ev(String(Gl_aRithm[0][1]));
}; 

//Из строки sInput вида "<tag1>=kghkjh;<tagXXX>=6754;" выделяет значение (от "=" до ";" в тэге sTag (первом?, есди их несколько)) (тэг регистронезавис.)
function VbyTag (sTag, sInput) {
    var sRet = "" 
    var nBeg = sInput.toLowerCase().indexOf(sTag.toLowerCase()) 
    if (nBeg >= 0)
	{
		nBeg = nBeg + sTag.length  
		var flBeg = 0  
		var flEnd = 0  
		var i = nBeg
		while ((i < sInput.length) && (flEnd == 0) && !(sInput[i] == ';'))
		{
			if ((flBeg == 1) && (flEnd == 0)) sRet = sRet + sInput[i]  
			if (sInput[i] == '=') flBeg = 1
			if (sInput[i] == ';')
			{
				flBeg = 0
				flEnd = 1
			}

			i++  
		}
    }

    return sRet

}; 
/*
 //выдает значение по тэгу <id> (регистронезавис.) Если тэга нет - выдает всю строку
 function V(sInput)  {
 var sRet = VbyTag ("<id>",sInput)  
 if (sRet.trim() == "") 
 if (!(sInput.toLowerCase().indexOf("<id>") >= 0)) sRet = sInput 
 return sRet
 };   
 //выдает значение по тэгу <say> (использовать для текста, который будет произноситься вслух) (регистронезавис.) Если тэга нет - выдает всю строку
 function Say(sInput)  {
 var sRet = VbyTag ("<say>",sInput)  
 if (sRet.trim() == "") 
 if (!(sInput.toLowerCase().indexOf("<say>") >= 0)) sRet = sInput 
 return sRet
 };      

 //выдает индекс дела по строке - если в ней есть тэг <id>, то значение тэга ИД    
 //function DealInd(sIdOrInd)  {
 //  var sRet = VbyTag ("<say>",sInput)  
 //  if (sRet.trim() == "") 
 //    if (!(sInput.toLowerCase().indexOf("<say>") >= 0)) sRet = sInput 
 //  return sRet
 //};          
 */ 

//текст текущего упражнения. aDealIndexes - массив индексов дел , которые делаются в текущем срабатывани ритма
function fget_TextToSpeek(aDealIndexes) {var sTextToSpeek = "";
    var sPoint = "";
	for (var i=0, len0=aDealIndexes.length; i < len0; i++)
	{
		sTextToSpeek += ev(Gl_aDeals[aDealIndexes[i]][0]) + " ";
		var nFullProp = 0;
		for (var j=1, len=Gl_aDeals[aDealIndexes[i]].length; j < len; j++)
		{
			nFullProp += Gl_aDeals[aDealIndexes[i]][j][1]; // Сумма пропорций навыка
		};
		var nRandProp = Math.floor(Math.random() * (nFullProp - 0 + 1)) + 0; //случайное число для определения одного из элементов навыка
		var nCurrProp = 0;//0 sic!
		var k = 1;
		while ((nCurrProp <= nRandProp)
			   && (Gl_aDeals[aDealIndexes[i]].length > k)
			   )
		{ //искомый элемент навыка - последний, до которого сумма пропорций < nRandProp  //<= sic!
			CurrProp += Gl_aDeals[aDealIndexes[i]][k][1];
			k = k + 1;
		};
		sPoint = (Gl_aDeals[aDealIndexes[i]][k - 1][0])
		//обработка ссылки на дела в деле
		//!!! придумать указатель понадежней чем ->
		//!!! поскольку используются формулы в  eval то это сочетание мб частью формулы а не ссылкой
		if ((sPoint.indexOf(">") > 0)
			&& (sPoint.indexOf(">") < 2) //-> строго вначале!!!
			)
		{
			sPoint = sPoint.replace("->", "")
			var aPointIndexes = sPoint.split(",")
			sTextToSpeek += " "  + fget_TextToSpeek(aPointIndexes) + ", "
		}
		else
		{
			sTextToSpeek += " " + ev(Gl_aDeals[aDealIndexes[i]][k - 1][0]) + ", "; //-1 sic! 
		}
	};
	return sTextToSpeek;
} //fget_TextToSpeek


//основная функция. Проверяет - если в данный момент времени нужно сгененить упражнения, то генерит
function fMain() { //если указана отсрочка старта - не идем дальше, пока не сбросим ее в 0
    if (GlnDelay > 0)
	{
		var 
			dCurrWait = new Date();
		var 
			HCurrWait = dCurrWait.getHours();
		var 
			MCurrWait = dCurrWait.getMinutes();
		var 
			SCurrWait = dCurrWait.getSeconds();
		var 
			MsCurrWait = dCurrWait.getMilliseconds();

		if ((HCurrWait - Gl_H) * 60 * 60 + (MCurrWait - Gl_M) * 60 + (SCurrWait - Gl_S) >= 1)
		{
			GlnDelay = GlnDelay - 1;
			Gl_dBeg = new Date();
			Gl_H = Gl_dBeg.getHours();
			Gl_M = Gl_dBeg.getMinutes();
			Gl_S = Gl_dBeg.getSeconds();  
			Gl_Ms = Gl_dBeg.getMilliseconds();
			if ((GlnDelay == 0) && (!(button.firstChild.data == TXT_BTN_PAUSED)))
			{
				GltxtSpeek.value = GltxtSpeek.value + "=== " + Gl_H + ":" + Gl_M + ":" + Gl_S + " ===  ОЖИДАНИЕ ОТСРОЧЕННОГО СТАРТА ЗАВЕРШЕНО ====" + "\n\n";
				GltxtSpeek.scrollTop = GltxtSpeek.scrollHeight;
				try
				{
					var utterance2 = new SpeechSynthesisUtterance("ОЖИДАНИЕ ОТСРОЧЕННОГО СТАРТА ЗАВЕРШЕНО");
					window.speechSynthesis.speak(utterance2);
				}
				catch(e) {
					//GltxtSpeek.value = GltxtSpeek.value + "НЕ ПОДКЛЮЧЕН СИНТЕЗАТОР ЗВУКА\n";
				};            
			};
			return;
		}  
    } 


    if ((GlnDelay == 0) &&
		((button.firstChild.data == TXT_BTN_NOTSTARTED) || (button.firstChild.data == TXT_BTN_STARTED)))
	{ 
		var dCurr = new Date();
		var HCurr = dCurr.getHours();
		var MCurr = dCurr.getMinutes();
		var SCurr = dCurr.getSeconds();
		var MsCurr = dCurr.getMilliseconds();
		//попытка не дать системе заснуть
		//if (sCurr%2 == 0){
      	//  button.style.backgroundColor = "#F6F6f6";}
		// else {
		//  button.style.backgroundColor = "#fc0707";}
		var nRandDispers = Math.floor(Math.random() * ev(String(Gl_aRithm[0][1])) * ev(String(Gl_aRithm[0][2])) / 100);
		nRandDispers *= Math.floor(Math.random() * 3 - 1);//+1 or -1 random
		if ((HCurr - Gl_H) * 60 * 60 + (MCurr - Gl_M) * 60 + (SCurr - Gl_S) + (MsCurr - Gl_Ms) / 1000 >= Gl_CurrDt + nRandDispers)
		{
			var dNow1 = new Date()
			_полноевремя_ = dNow1.getTime()
			_прошловремениВПроцентах_ = Math.floor(100 * (dNow1 - Gl_dBegTraining) / (1000 * (Gl_duration + 1)))
			_прошломилисекунд_ = Math.floor((dNow1 - Gl_dBegTraining))
			_прошлосекунд_ = Math.floor(_прошломилисекунд_ / 1000)
			_прошломинут_ = Math.floor(_прошлосекунд_ / 60)
			_прошлочасов_ = Math.floor(_прошломинут_ / 60)
			var sTextToSpeek = fget_TextToSpeek(Gl_aRithm[0][3]);
			//
			var dNow = new Date();
			var dT = dNow - dNowPrev;
			dNowPrev = dNow;
			GltxtSpeek.value = GltxtSpeek.value + "  " + dNow.getHours() + ":" + dNow.getMinutes() + ":" + dNow.getSeconds()  + ":" + dNow.getMilliseconds() + "  Случ.сдвиг = " + nRandDispers + " сек.   " + sTextToSpeek + "\n" + dT + "  прошло сек.:" + _прошлосекунд_ + "\n";
			GltxtSpeek.scrollTop = GltxtSpeek.scrollHeight;


			//
			try
			{
				var utterance = new SpeechSynthesisUtterance(sTextToSpeek);
				window.speechSynthesis.speak(utterance);
				_номеритерации_ += 1
				_номеритерации_1 += 1
				if (Gl_CountOfIterations < _номеритерации_)
				{
					_номеритерации_ = 1
					_номеритерации_1 = 0
				}
			}
			catch(e) {
				//GltxtSpeek.value = GltxtSpeek.value + "НЕ ПОДКЛЮЧЕН СИНТЕЗАТОР ЗВУКА\n";
			};
			//
			Gl_dBeg = new Date();
			Gl_H = Gl_dBeg.getHours();
			Gl_M = Gl_dBeg.getMinutes();
			Gl_S = Gl_dBeg.getSeconds();
			Gl_Ms = Gl_dBeg.getMilliseconds();

			fDecGl_aRithm();

		};  
		var  //!!!!!!!!!!???
			Gl_dCurr = new Date();
		if (Gl_aRithm.length < 1)
		{
			GltxtSpeek.value = GltxtSpeek.value + "\n== " + Gl_dCurr.getHours() + ":" + Gl_dCurr.getMinutes() + ":" + Gl_dCurr.getSeconds() + " === ТРЕНИРОВКА ЗАВЕРШЕНА. ======================\n"
			GltxtSpeek.scrollTop = GltxtSpeek.scrollHeight;  
			try
			{
				var utterance1 = new SpeechSynthesisUtterance("ТРЕНИРОВКА ЗАВЕРШЕНА.\n");
				window.speechSynthesis.speak(utterance1);
			}
			catch (e){};

			button.firstChild.data = TXT_BTN_FINISHED;
			button.disabled = true;
		}  
    }
}; //fMain    

//вывод информации о содержании тренировки    
function loadTrainData() {
    button.firstChild.data = TXT_BTN_NOTSTARTED;
    button.style.width = document.body.clientWidth - 20; 
    GltxtSpeek.style.width = button.style.width;
    //
    //var oTxt = document.getElementById('idTextsToSpeek')
    GltxtSpeek.value = "===  Тренировка:  =========================\n\n";
 /*тест
 
	var nDuration = 0
    for (var i = 0; i < Gl_aRithm.length; i++)
	{ 
		nDuration += Gl_aRithm[i][0] * ev(String(Gl_aRithm[i][1]))    
    }
    Gl_duration = nDuration 
    var nSecDur = nDuration % 60  
    var nMinDur = (Math.floor(nDuration / 60)) % 60  
    var nHDur = Math.floor(Math.floor(nDuration / 60) / 60) % 60
    GltxtSpeek.value += "\nПродолжительность:  " + nHDur + " часов, " + nMinDur + " минут, " + nSecDur + " секунд\n" 

    GltxtSpeek.value = GltxtSpeek.value + "\n" + Gl_ShortDescription + "\n\n"

    for (var i = 0; i < Gl_aRithm.length; i++)
	{ 
		Gl_CountOfIterations += Gl_aRithm[i][0] 
		GltxtSpeek.value += "\nВ ритме:  ";
		GltxtSpeek.value += Gl_aRithm[i][0] + " раз по " + ev(String(Gl_aRithm[i][1])) + " сек. с дисперсией " + ev(String(Gl_aRithm[i][2])) + "%";//\n";
		GltxtSpeek.value += "  Упражнение:\n";
		for (var j = 0; j < Gl_aRithm[i][3].length ; j++)
		{
			GltxtSpeek.value += "  " + (j + 1) + ": ";// \n";//":\n";
			//for (var k = 1; k< Gl_aRithm[i][3].length; k++){
			GltxtSpeek.value += "  " + Gl_aDeals[Gl_aRithm[i][3][j]][0] + ", одно из перечисленных (с долей вероятности):  \n";
			var nFProp = 0;
			for (var l=1; l < Gl_aDeals[Gl_aRithm[i][3][j]].length; l++)  nFProp += Gl_aDeals[Gl_aRithm[i][3][j]][l][1];       
			for (var l=1; l < Gl_aDeals[Gl_aRithm[i][3][j]].length; l++)
			{
				GltxtSpeek.value += "          " + Gl_aDeals[Gl_aRithm[i][3][j]][l][0] + " ( " + Gl_aDeals[Gl_aRithm[i][3][j]][l][1] + " из " + nFProp + ")\n" 
				// }   
			}  
		};    
    }

    GltxtSpeek.value += "\n\n Для изменения тренировки необходимо редактировать запускаемый файл html.\n";   
	*/
}

//изменение размеров элементов при изменении размеров окна          
function resizeAll() {
    button.style.width = document.body.clientWidth - 20; 
    GltxtSpeek.style.width = button.style.width;
}    
</script> 
	 
  </head>
   
  <body onload="loadTrainData()" onresize = "resizeAll()">

  <p>
	<button id = "idStartBtn" style = "width:600px;height:100px" >Начать</button>
  </p>
   
  <p>
	Отложить начало на 
	<textarea id = "idTxtDelay" style = "width:50px;height:20px" value = '0'> </textarea>
	сек.
  </p>
  <p>

	Повторить тренировку 
	<textarea id = "idTxtRepeat" style = "width:50px;height:20px" value = '1'> </textarea>
	раз
  </p>

  <p>
	<textarea id = "idTextsToSpeek" style = "width:600px;height:400px"> </textarea>
  </p>

   

<script>

var button = document.getElementById("idStartBtn");//.body.firstElementChild;
var GltxtSpeek  = document.getElementById("idTextsToSpeek");  
var GlUtterance = new SpeechSynthesisUtterance("");    

//длЯ задержки начала тренировки (чтобы закрепить смартфон после нажатия стартовой кнопки)
var GlnDelay = 0;

//изменение текста на кнопке в соответствие с текущим статусом тренировки. Запуск основного цикла-таймера   
button.onclick = function() { 
loadTrainData(); //тест
//alert(ev("2+2"))
//alert(V ("<qw6> = 123;<id>=;  <qw4>=32 1 6"))
	if ((Gl_ShortDescription.trim().length > 0) && (button.firstChild.data == TXT_BTN_NOTSTARTED))
	{
        try
		{
			//GltxtSpeek.value = GltxtSpeek.value + "\n" + Gl_ShortDescription + "\n\n"
			var utterance0 = new SpeechSynthesisUtterance("План тренировки: " + Gl_ShortDescription)
			window.speechSynthesis.speak(utterance0)
        }
        catch(e) {
			GltxtSpeek.value = GltxtSpeek.value + "\nНЕ ПОДКЛЮЧЕН СИНТЕЗАТОР ЗВУКА. ИСПОЛЬЗУЙТЕ БРАУЗЕР CHROME\n\n";
        }    
	}




    //Повторы - клонируем массив ритмов, если нужно повторить более 1 раза
	if (Number(document.getElementById("idTxtRepeat").value) ===     //проверка на целое:   а === (а^0)
		(Number(document.getElementById("idTxtRepeat").value) ^ 0))
	{
		GlnRepeat = Number(document.getElementById("idTxtRepeat").value);
		document.getElementById("idTxtRepeat").disabled = true;
	} 
	else
	{
		GlnRepeat = 1;
		alert('Введите целое число раз, сколько нужно повторить тренировку, и нажмите кнопку снова.');
		return;
	}
	if (GlnRepeat > 1)
	{  //увеличим массив Gl_aRithm в GlnRepeat раз
        var nL = Gl_aRithm.length  
        Gl_aRithm.length = (nL * GlnRepeat)    
        for (var inL = 1; inL <= nL; inL++)
		{  
            for (var i =0; i < nL; i++)
			{ 
				Gl_aRithm[i + nL * inL] = []    
				Gl_aRithm[i + nL * inL].length = Gl_aRithm[i].length    
				for (var j =0; j < Gl_aRithm[i].length; j++)
				{   
					if (j == 3)
					{  
						Gl_aRithm[i + nL * inL][j] = []
						Gl_aRithm[i + nL * inL][j].length = Gl_aRithm[i][j].length
					}
					if (!(j == 3))
					{
						Gl_aRithm[i + nL * inL][j] = Gl_aRithm[i][j] 
					}
					else
						for (var k =0; k < Gl_aRithm[i][j].length; k++)
						{ 
							Gl_aRithm[i + nL * inL][j][k] = Gl_aRithm[i][j][k] 
						}  
				}
            }
        }
	}     

    //длЯ задержки начала тренировки (чтобы закрепить смартфон после нажатия стартовой кнопки)
	if (
		(Number(document.getElementById("idTxtDelay").value) ===     //проверка на целое:   а === (а^0)
		(Number(document.getElementById("idTxtDelay").value) ^ 0)) 

		)
	{
		if (!(button.firstChild.data == TXT_BTN_PAUSED))
  	  	    GlnDelay = Number(document.getElementById("idTxtDelay").value)
		else GlnDelay = 0;
		document.getElementById("idTxtDelay").disabled = true;
	} 
	else
	{
		GlnDelay = 0;
		alert('Введите целое число секунд, на которое нужно отсрочить начало и нажмите кнопку еще раз.');
		return;
	}

    var dNow = new Date();        
    try
	{
		var utterance = new SpeechSynthesisUtterance("\n\nТРЕНИРОВКА НАЧАТА\n\n");
		if (!(
			(button.firstChild.data == TXT_BTN_NOTSTARTED)  ||
			(button.firstChild.data == TXT_BTN_PAUSED)))	   	
			utterance = new SpeechSynthesisUtterance("\n\nТРЕНИРОВКА ПРИОСТАНОВЛЕНА\n\n");
		window.speechSynthesis.speak(utterance);
    }
    catch(e) {
		GltxtSpeek.value = GltxtSpeek.value + "\nНЕ ПОДКЛЮЧЕН СИНТЕЗАТОР ЗВУКА. ИСПОЛЬЗУЙТЕ БРАУЗЕР CHROME\n\n";
    };


    if (
        (button.firstChild.data == TXT_BTN_NOTSTARTED)  ||
        (button.firstChild.data == TXT_BTN_PAUSED))
	{    
		GltxtSpeek.value = GltxtSpeek.value + "\n=== " + dNow.getHours() + ":" + dNow.getMinutes() + ":" + dNow.getSeconds() + " === ТРЕНИРОВКА НАЧАТА ==========================\n\n";
		GltxtSpeek.scrollTop = GltxtSpeek.scrollHeight;    
		button.firstChild.data = TXT_BTN_STARTED;
		Gl_dBegTraining = new Date()
		if (GlnDelay > 0)
		{
    	    GltxtSpeek.value = GltxtSpeek.value + "\n=== " + dNow.getHours() + ":" + dNow.getMinutes() + ":" + dNow.getSeconds() + " === НАЧАЛО ТРЕНИРОВКИ ОТЛОЖЕНО НА " + GlnDelay + " сек. ======\n\n";
    	    GltxtSpeek.scrollTop = GltxtSpeek.scrollHeight;    
		}
    }
	else
	{
		if (button.firstChild.data == TXT_BTN_STARTED)
		{    
			GltxtSpeek.value = GltxtSpeek.value + "\n=== " + dNow.getHours() + ":" + dNow.getMinutes() + ":" + dNow.getSeconds() + " === ТРЕНИРОВКА ПРИОСТАНОВЛЕНА ==================\n\n";
			button.firstChild.data = TXT_BTN_PAUSED;
			GltxtSpeek.scrollTop = GltxtSpeek.scrollHeight;
		};// else ;  
    };

    //* 
    //#####  ѓлавный цикл с задержками по 1 мс  ######################################## 
	if (
        (button.firstChild.data == TXT_BTN_NOTSTARTED)  ||
        (button.firstChild.data == TXT_BTN_STARTED)     ||
        (button.firstChild.data == TXT_BTN_PAUSED)) 
	{ dNowPrev = new Date();
		setInterval(fMain, 1);  //цикл с задержками по 1 мс
	} 
    //##################################################################################
    //* 

}
</script>
</html>
